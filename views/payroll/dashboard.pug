extends ../layout

block content
  .payroll-dashboard-page
    .payroll-header.d-flex.flex-wrap.align-items-center.justify-content-between.mb-3.gap-2
      h1.mb-0 Payroll dashboard
      .d-flex.gap-2.flex-wrap
        a.btn.btn-outline-primary(href='/payroll/attendance') Attendance stats
        a.btn.btn-outline-secondary(href='/payroll') ↁEBack to list

    .card.payroll-chart-card.mb-4
      .card-body
        h3.card-title.mb-3 Multi-year net trend
        canvas#netChart.w-100(style='max-width:980px;height:420px')

    .card.mb-4
      .card-body
        h3.card-title.mb-3 Yearly totals
        .table-responsive
          table.table.table-striped.table-dark.align-middle.mb-0
            thead
              tr
                th Year
                th.text-end Gross
                th.text-end Gross YoY %
                th.text-end Net
                th.text-end Net YoY %
            tbody
              each r in yearSummary
                tr(class=r.isPrediction ? 'table-warning text-dark' : '')
                  td
                    if !r.isPrediction
                      a.fw-semibold(href=`/payroll/year/${r.year}`) #{r.label || r.year}
                    else
                      | #{r.label || r.year}
                  td.text-end #{r.gross.toLocaleString()}
                  td.text-end #{r.grossYoY != null ? r.grossYoY.toFixed(1)+'%' : '—'}
                  td.text-end #{r.net.toLocaleString()}
                  td.text-end #{r.netYoY != null ? r.netYoY.toFixed(1)+'%' : '—'}

    .card
      .card-body
        h3.card-title.mb-3 6-month forecast
        .table-responsive.w-auto
          table.table.table-bordered.table-dark.align-middle.mb-0
            thead
              tr
                th Month
                th.text-end Predicted net
            tbody
              each f in forecast
                tr
                  td #{f.month}
                  td.text-end #{f.predicted.toLocaleString()}

block script
  script(src='https://cdn.jsdelivr.net/npm/chart.js')
  script.
    const ctx = document.getElementById('netChart').getContext('2d');
    const datasets = !{chartData};
    new Chart(ctx,{
      type:'line',
      data:{ labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
             datasets },
      options:{ responsive:true, plugins:{legend:{position:'bottom'}} }
    });
