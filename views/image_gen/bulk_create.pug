//- views/image_gen/bulk_create.pug
extends ../layout

block styles
  style.
    .panel{background:var(--surface-1);color:var(--text);border:1px solid var(--border);border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 20px 48px rgba(0,0,0,0.28)}
    .panel h2{font-size:1.05rem;margin-bottom:1rem;color:var(--text)}
    .panel small{color:var(--text-muted)}
    .template-item,.placeholder-item{background:var(--surface-2);border:1px solid var(--divider);border-radius:.85rem;padding:1rem;margin-bottom:.75rem}
    .template-item h3,.placeholder-item h3{font-size:.95rem;margin-bottom:.75rem;color:var(--text-secondary)}
    .flex-gap{display:flex;flex-wrap:wrap;gap:.75rem}
    .pill{display:inline-flex;align-items:center;padding:.25rem .75rem;border-radius:999px;border:1px solid var(--divider);background:var(--surface-2);color:var(--text-secondary);text-transform:uppercase;letter-spacing:.08em;font-size:.72rem}
    textarea.form-control{min-height:120px;background:var(--surface-2);color:var(--text);border:1px solid var(--border)}
    .sticky-actions{position:sticky;bottom:0;background:rgba(14,15,19,0.92);backdrop-filter:blur(12px);padding:1rem;border-top:1px solid var(--border);margin:0 -1.5rem -1.5rem;border-radius:0 0 1rem 1rem;box-shadow:0 -12px 32px rgba(0,0,0,0.4)}
    .text-soft{color:var(--text-muted)}
    .text-soft{color:var(--text-muted)}

block content
  .container.py-4
    a.text-decoration-none.text-soft(href="/image_gen/bulk") Back to bulk jobs
    h1.h4.mt-2.mb-3 Create Bulk Prompt Experiment
    form#jobForm
      .panel
        h2 Workflow & Base Inputs
        .row.g-3
          .col-md-6
            label.form-label(for="jobName") Job name
            input#jobName.form-control(type="text" placeholder="e.g. Lighting study 01" required)
          .col-md-6
            label.form-label(for="workflowSelect") Workflow
            select#workflowSelect.form-select(required)
        .mt-3
          small.text-soft Choose a workflow first to configure base inputs. Prompt and negative prompt inputs will be handled per template.
        .mt-3#workflowInputs
          .text-soft Loading workflow definitions…
        .mt-4#workflowImageInputs.d-none
          h3.h6.mb-2 Image filename lists
          p.text-soft.mb-3 Provide one filename per line for each image input. Filenames must already exist in the ComfyUI input folder.
          #imageInputList
          .alert.alert-warning.d-none#imageInputAlert Image filename lists are required for workflows that use image inputs.
      .panel
        .d-flex.justify-content-between.align-items-center.mb-2
          h2.mb-0 Prompt Templates
          button#addTemplateBtn.btn.btn-outline-secondary.btn-sm(type="button") Add template
        p.text-soft.mb-3 Provide at least one prompt template. Use placeholders like {{style}}. All templates must share the same placeholders.
        #templateList
        .alert.alert-warning.d-none#templateEmptyAlert Please add at least one prompt template.
      .panel
        .d-flex.justify-content-between.align-items-center.mb-2
          h2.mb-0 Placeholder Values
          button#addPlaceholderBtn.btn.btn-outline-secondary.btn-sm(type="button") Add placeholder
        p.text-soft.mb-3 Define each placeholder referenced by your templates. Values are newline-separated.
        #placeholderList
        .alert.alert-info.d-none#placeholderHint Placeholder keys detected from templates will appear here automatically.
      .panel
        h2 Negative Prompt (optional)
        textarea#negativePrompt.form-control(placeholder="Enter a negative prompt to test with and without it")
      .panel
        h2 Review
        .flex-gap.mb-2
          span.pill#summaryPrompts 0 templates
          span.pill#summaryPlaceholders 0 placeholders
          span.pill#summaryImages 0 image inputs
          span.pill#summaryCombinations 0 combinations
        p.text-soft.mb-0 A job will generate every combination of placeholders across all templates. With a negative prompt supplied the job will run both with and without it.
      .panel
        .sticky-actions.d-flex.gap-2.flex-wrap.justify-content-between.align-items-center
          span#formStatus.text-soft
          .d-flex.gap-2
            a.btn.btn-outline-secondary(href="/image_gen/bulk") Cancel
            button#submitBtn.btn.btn-primary(type="submit") Create job

block script
  script(src="/js/image_gen_bulk_create.js")
