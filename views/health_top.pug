extends layout

block content
  .row
    .col
      h2 Health Tracker Dashboard
      p.text-muted Gain rolling averages, alerts, and quick links into each daily log.

  .row.mb-3.g-3
    .col-md-3
      label.form-label(for="start_date") Start Date
      input#start_date.form-control(type="date", name="start_date")
    .col-md-3
      label.form-label(for="end_date") End Date
      input#end_date.form-control(type="date", name="end_date")
    .col-md-3.d-flex.align-items-end
      button.btn.btn-primary.w-100(onclick="UpdateHealthLogDisplay()") Refresh

  .row.mb-4.g-3
    .col-md-3
      label.form-label(for="metricSelect") Focus Metric
      select#metricSelect.form-select(onchange="handleMetricChange()")
        option(value="auto") Auto detect
    .col-md-3
      label.form-label(for="windowSelect") Rolling Window
      select#windowSelect.form-select(onchange="UpdateHealthLogDisplay()")
        option(value="7") 7 days
        option(value="14") 14 days
        option(value="30") 30 days
    .col-md-3
      label.form-label(for="alertFilter") Alert Filter
      select#alertFilter.form-select(onchange="renderAlertBanners()")
        option(value="all") All alerts
        option(value="high") High only
        option(value="low") Low only
    .col-md-3.d-flex.align-items-end.justify-content-end
      button#exportAnalytics.btn.btn-outline-secondary(type="button", onclick="exportAnalyticsCsv()")
        | Export analytics CSV

  .row.g-4
    .col-lg-8
      .card.h-100
        .card-body
          .d-flex.justify-content-between.align-items-center
            h4.card-title.mb-0 Trend Overview
            span.badge.bg-light.text-dark Window:
              span#windowLabel.ms-1 7d
          canvas#metricChart(height="160").mt-3
    .col-lg-4
      h4 Active Alerts
      #alertBanners

  .row.mt-4
    .col
      h4 Metric Highlights
      .row#trendCards.g-3

  .row.mt-4
    .col
      h4 Health Logs
      table.table.table-striped
        thead
          tr
            th Date
            th Basic Data
            th Medical Record
            th Diary
            th Measurement
            th Tags
            th Alerts
            th Actions
        tbody#health_log

  .row.mt-4
    .col
      label(for="edit_date") Jump to date
      .input-group
        input#edit_date.form-control(type="date", name="edit_date")
        button.btn.btn-secondary(type="button", onclick="OpenEditDate()") Edit/Create

  #detailsPopup.modal.fade.popup(tabindex="-1", aria-hidden="true", style="z-index: 1051;")
    .modal-dialog
      .modal-content.h-modal-content
        .modal-header
          h5.modal-title Details
          button.close(type="button", onclick="HidePopup()", aria-label="Close")
            span(aria-hidden="true") &times;
        .modal-body
          p#detailsContent.mb-2
          div#detailsMetadata

  script(src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js")
  script(src="/health_top.js")
