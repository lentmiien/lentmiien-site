extends layout

block styles
  style.
    /* Scoped styles for My Page tiles */
    .mypage-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:16px; }
    a.mypage-tile { text-decoration:none; color:inherit; display:block; }
    .img-card { display:block; border-radius:16px; padding:2px; background: linear-gradient(135deg,#dbeafe,#fce7f3 40%,#fef9c3); transition: transform .15s ease, box-shadow .15s ease; }
    .img-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,.15); }
    .img-card__inner { position:relative; overflow:hidden; border-radius:14px; background:#fff; }
    .mypage-img { width:100%; height:160px; object-fit:cover; display:block; background:#111; }
    .img-card__label { position:absolute; left:8px; right:8px; bottom:8px; padding:6px 10px; border-radius:10px; background: rgba(255,255,255,.88); color:#111; font-weight:600; text-align:center; border:1px solid rgba(0,0,0,.06); backdrop-filter: blur(4px); }

mixin tile(href, src, alt, label)
  a.mypage-tile(href=href)
    .img-card
      .img-card__inner
        img.mypage-img(src=src, alt=alt)
        span.img-card__label= label

block content
  .row 
    .col 
      each t in tasks 
        if !t.done && t.type === "todo"
          span.badge.bg-primary.me-1.schedule-task-pill= `${t.title} in ${t.start && t.start.getTime() > Date.now() ? Math.round((t.start.getTime() - Date.now()) / (1000*60*60)) : t.end && t.end.getTime() > Date.now() ? Math.round((t.end.getTime() - Date.now()) / (1000*60*60)) : 0} hour(s)`
      each t in tasks 
        if !t.done && t.type === "tobuy"
          span.badge.bg-warning.text-dark.me-1.schedule-task-pill= t.title
      a.badge.bg-secondary.me-1.schedule-task-pill(href='/scheduleTask/upcoming') All tasks
  .row 
    .col 
      .mypage-grid
        +tile('/mypage/blogpost', '/i/blog.jpg', 'blogpost', 'Write blog')
        if permissions && permissions.indexOf("accounting") >= 0
          +tile('/accounting/add_transaction', '/i/budget.jpg', 'budget', 'Add transaction')
        if permissions && permissions.indexOf("chat4") >= 0
          +tile('/chat5', '/i/chat.jpg', 'chat', 'Chat')
          +tile('/chat5/top', '/i/chat5.jpg', 'chat5', 'Chat 5')
          +tile('/chat4/knowledgelist?category=Recipe', '/i/cookbook.jpg', 'cookbook', 'Cookbook')
          +tile('/chat4/knowledgelist', '/i/knowledge.jpg', 'knowledge', 'Knowledge')
        if permissions && permissions.indexOf("cooking") >= 0
          +tile('/cooking', '/i/calendar.jpg', 'cooking calendar', 'Cooking calendar')
        +tile('/chat4/batch_status', '/i/batch.jpg', 'batch', 'Batch')
        +tile('/', '/i/vueapp.jpg', 'vue app', 'VUE app')
        +tile('/mypage/pdf_to_jpg', '/i/pdfconv.jpg', 'PDF to image converter', 'PDF to Image')
        if permissions && permissions.indexOf("receipt") >= 0
          +tile('/receipt', '/i/receipt.jpg', 'upload receipt', 'Upload receipt')
        if permissions && permissions.indexOf("product") >= 0
          +tile('/product', '/i/product.jpg', 'Product details', 'Product details')
        if permissions && permissions.indexOf("gallery") >= 0
          +tile('/gallery', '/i/gallery.jpg', 'Gallery', 'Gallery')
        if permissions && permissions.indexOf("payroll") >= 0
          +tile('/payroll', '/i/payroll.jpg', 'Payroll', 'Payroll')
        if permissions && permissions.indexOf("emergencystock") >= 0
          +tile('/es/es_dashboard', '/i/stock.jpg', 'Emergency stock', 'Emergency stock')
        if permissions && permissions.indexOf("scheduletask") >= 0
          +tile('/scheduleTask/calendar', '/i/schedule.jpg', 'Calendar', 'Calendar')
        if permissions && permissions.indexOf("image_gen") >= 0
          +tile('/image_gen', '/i/img_gen.jpg', 'Generate and edit images', 'Image Gen')
  if new_openai_models.length > 0
    .row 
      .col
        h3 New OpenAI models (last 30 days)
        each m in new_openai_models
          span(style="border: 1px solid gray; margin: 3px; padding: 2px; border-radius: 5px; display: inline-block;")= `${m.model} (${(new Date(m.created*1000)).toDateString()})`
  if new_anthropic_models.length > 0
    .row 
      .col
        h3 New Anthropic models (last 30 days)
        each m in new_anthropic_models
          span(style="border: 1px solid gray; margin: 3px; padding: 2px; border-radius: 5px; display: inline-block;")= `${m.model} (${(new Date(m.created*1000)).toDateString()})`
