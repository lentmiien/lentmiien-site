extends layout

mixin tile(href, src, alt, label)
  a.mypage-tile(href=href)
    .img-card
      .img-card__inner
        img.mypage-img(src=src, alt=alt)
        span.img-card__label= label

block content
  .row 
    a(href='/scheduleTask/upcoming')
      .col 
        - let noTasks = true
        each t in tasks 
          if !t.done && t.type === "todo"
            - noTasks = false
            span.badge.schedule-task-pill.schedule-task-pill--todo= `${t.title} in ${t.start && t.start.getTime() > Date.now() ? Math.round((t.start.getTime() - Date.now()) / (1000*60*60)) : t.end && t.end.getTime() > Date.now() ? Math.round((t.end.getTime() - Date.now()) / (1000*60*60)) : 0} hour(s)`
        each t in tasks 
          if !t.done && t.type === "tobuy"
            - noTasks = false
            span.badge.schedule-task-pill.schedule-task-pill--tobuy= t.title
        if noTasks
          span.badge.schedule-task-pill.schedule-task-pill--empty Show all tasks
  .row 
    .col 
      .mypage-grid
        +tile('/mypage/blogpost', '/i/blog.jpg', 'blogpost', 'Write blog')
        if permissions && permissions.indexOf("accounting") >= 0
          +tile('/accounting/add_transaction', '/i/budget.jpg', 'budget', 'Add transaction')
        if permissions && permissions.indexOf("chat4") >= 0
          +tile('/chat5', '/i/chat.jpg', 'chat', 'Chat')
          +tile('/chat5/top', '/i/chat5.jpg', 'chat5', 'Chat 5')
          +tile('/chat4/knowledgelist?category=Recipe', '/i/cookbook.jpg', 'cookbook', 'Cookbook')
          +tile('/chat4/knowledgelist', '/i/knowledge.jpg', 'knowledge', 'Knowledge')
        if permissions && permissions.indexOf("cooking") >= 0
          +tile('/cooking/v2', '/i/calendar.jpg', 'cooking calendar', 'Cooking calendar')
        +tile('/chat4/batch_status', '/i/batch.jpg', 'batch', 'Batch')
        +tile('/', '/i/vueapp.jpg', 'vue app', 'VUE app')
        +tile('/mypage/pdf_to_jpg', '/i/pdfconv.jpg', 'PDF to image converter', 'PDF to Image')
        if permissions && permissions.indexOf("receipt") >= 0
          +tile('/receipt', '/i/receipt.jpg', 'upload receipt', 'Upload receipt')
        if permissions && permissions.indexOf("product") >= 0
          +tile('/product', '/i/product.jpg', 'Product details', 'Product details')
        if permissions && permissions.indexOf("gallery") >= 0
          +tile('/gallery', '/i/gallery.jpg', 'Gallery', 'Gallery')
        if permissions && permissions.indexOf("payroll") >= 0
          +tile('/payroll', '/i/payroll.jpg', 'Payroll', 'Payroll')
        if permissions && permissions.indexOf("emergencystock") >= 0
          +tile('/es/es_dashboard', '/i/stock.jpg', 'Emergency stock', 'Emergency stock')
        if permissions && permissions.indexOf("scheduletask") >= 0
          +tile('/scheduleTask/calendar', '/i/schedule.jpg', 'Calendar', 'Calendar')
        if permissions && permissions.indexOf("image_gen") >= 0
          +tile('/image_gen', '/i/img_gen.jpg', 'Generate and edit images', 'Image Gen')
          +tile('/image_gen/bulk', '/i/img_gen_bulk.jpg', 'Generate and edit images in batches', 'Image Gen bulk')
        if permissions && permissions.indexOf("sora") >= 0
          +tile('/sora', '/i/vid_gen.jpg', 'Generate and edit short videos', 'Video Gen')
  if new_openai_models.length > 0
    .row 
      .col
        h3.mypage-section-title New OpenAI models (last 30 days)
        each m in new_openai_models
          span.model-tag.model-tag--openai= `${m.model} (${(new Date(m.created*1000)).toDateString()})`
  if new_anthropic_models.length > 0
    .row 
      .col
        h3.mypage-section-title New Anthropic models (last 30 days)
        each m in new_anthropic_models
          span.model-tag.model-tag--anthropic= `${m.model} (${(new Date(m.created*1000)).toDateString()})`
