extends layout

block content
  .row
    .col
      ul#myTab.nav.nav-tabs(role="tablist")
        li.nav-item(role="presentation")
          button#newchat-tab.nav-link(data-bs-toggle="tab", data-bs-target="#newchat", type="button", role="tab", aria-controls="newchat", aria-selected="false") New chat
        li.nav-item(role="presentation")
          button#templates-tab.nav-link(data-bs-toggle="tab", data-bs-target=`#templates`, type="button", role="tab", aria-controls=`templates`, aria-selected="false") Templates
        li.nav-item(role="presentation")
          button#chathistory-tab.nav-link.active(data-bs-toggle="tab", data-bs-target=`#chathistory`, type="button", role="tab", aria-controls=`chathistory`, aria-selected="true") Chat history
      .tab-content
        #newchat.tab-pane.fade(role="tabpanel" aria-labelledby="newchat-tab")
          form#chatform(action="/chat4/post/new", method="post", enctype="multipart/form-data") 
            label(for="title") Title 
            input#title.form-control(type="text", name="title", required)
            label(for="category") Category 
            input#category.form-control(type="text", name="category", required)
            label(for="tags") Tags (comma separated)
            input#tags.form-control(type="text", name="tags", required)
            label(for="img") Upload an image (JPEG, PNG, WebP, AVIF, GIF, SVG or TIFF)
            input#imgs.form-control(type="file", name="imgs", multiple)
            label(for="context") Context
            textarea#context.form-control(name="context", cols="30", rows="10", required) You are a helpful assistant.
            label(for="prompt") Prompt
            textarea#prompt.form-control(name="prompt", cols="30", rows="10", required)
            #knowledge_container.row
            .button-container
              button.btn.btn-secondary(type="button", onclick="TemplatesPopup()") Templates
              input.btn.btn-primary(type="submit", value="Send", onclick="showLoadingPopup()")
      .tab-content
        #templates.tab-pane.fade(role="tabpanel" aria-labelledby="templates-tab")
          h3 Templates
          label(for="prompt_template") Chat prompt 
          select#prompt_template.form-control(name="prompt_template", onchange="SetChatTemplate(this)") 
            option(value="") -Select-
            each t in templates
              if t.Type === "chat" || t.Type === "image"
                option(value=`${t.TemplateText}`)= `[${t.Category}] ${t.Title}` 
          label(for="context_template") Context prompt 
          select#context_template.form-control(name="context_template", onchange="SetContextTemplate(this)") 
            option(value="") -Select-
            each t in templates
              if t.Type === "context"
                option(value=`${t.TemplateText}`)= `[${t.Category}] ${t.Title}` 
          hr
          h3 Knowledges 
          .row
            each knowledge in knowledges 
              .col
                input(id=`id_${knowledge._id.toString()}`, type="checkbox", data-id=`${knowledge._id.toString()}`, data-bs-toggle="tooltip", data-bs-placement="bottom", data-title=`${knowledge.title}`, title=`${knowledge.contentMarkdown}`, onclick="knowledgeCheck(this)")
                span=  knowledge.title
      .tab-content
        #chathistory.tab-pane.fade.show.active(role="tabpanel" aria-labelledby="chathistory-tab")
          each category in categories
            h3= category
            .button-container
              each c in conversations
                if category === c.category
                  .input-group
                    a.btn.btn-info(href=`/chat4/chat/${c._id.toString()}`, title=`${c.description}`)
                      div= c.title
                      div(style="font-size:smaller;")= `(${c.tags.join(', ')})`
                    button.btn.btn-info(data-bs-toggle="tooltip", data-bs-placement="bottom", title=`${c.description}`) info
  #loadingPopup.loading-popup
    .loading-content
      .loader
      p Loading...
  script(src="/js/chat4.js") 
